# 数据库中文显示乱码问题修复计划

## 问题分析

1. **现象**：商品名称和描述在网页上显示为乱码，例如"??Buds Pro 2"、"???????????"

2. **已检查的配置**：
   - 数据库连接URL已设置 `characterEncoding=utf8`
   - 数据库表使用 `utf8mb4_unicode_ci` 字符集
   - JSP页面已设置UTF-8编码
   - 数据库驱动使用正确

3. **可能原因**：
   - 插入数据时连接未正确设置字符集
   - 数据库中已存在乱码数据
   - 连接URL缺少额外的字符集参数

## 修复方案

### 1. 修复数据库连接URL

**修改db.properties文件**，添加额外的字符集参数：
- 将当前URL：`jdbc:mysql://localhost:3306/shoppingdb?useSSL=false&serverTimezone=UTC&characterEncoding=utf8`
- 修改为：`jdbc:mysql://localhost:3306/shoppingdb?useSSL=false&serverTimezone=UTC&characterEncoding=utf8&useUnicode=true&characterSetResults=utf8`

### 2. 修复数据库中的乱码数据

- 导出当前产品数据
- 清理乱码数据
- 重新插入正确的中文数据

### 3. 验证修复效果

- 重启Tomcat服务器
- 访问网站，检查商品名称和描述是否正确显示

## 执行步骤

### 步骤1：修改数据库连接URL
1. 编辑 `src/com/shopping/util/db.properties` 文件
2. 更新数据库连接URL，添加 `useUnicode=true` 和 `characterSetResults=utf8` 参数
3. 重新编译项目
4. 重新打包WAR文件
5. 重新部署到Tomcat服务器

### 步骤2：修复数据库中的乱码数据
1. 创建一个新的SQL脚本，包含所有正确的中文产品数据
2. 执行SQL脚本，替换数据库中的乱码数据

### 步骤3：验证修复效果
1. 访问网站的商品管理页面
2. 检查所有商品的名称、描述和分类是否正确显示
3. 验证其他页面的中文显示是否正常

## 预期效果

- 所有商品名称和描述正确显示中文
- 商品分类显示正常
- 其他中文内容（如按钮、菜单）显示正常

## 替代方案

如果上述方案无效，考虑以下替代方案：

1. **检查Tomcat服务器编码设置**
   - 修改Tomcat的 `server.xml` 文件，在Connector标签中添加 `URIEncoding="UTF-8"`

2. **检查JVM编码设置**
   - 在Tomcat的 `catalina.bat` 中添加 `-Dfile.encoding=UTF-8`

3. **重新创建数据库**
   - 备份数据
   - 删除现有数据库
   - 重新创建数据库，确保字符集设置正确
   - 重新导入数据

## 注意事项

- 确保在修改配置文件后重新编译和打包
- 确保Tomcat服务器已重启
- 确保数据库连接URL中的字符集参数正确
- 修复数据时注意备份原有数据

## 后续维护

- 定期检查数据库中的数据编码
- 确保所有数据插入操作都使用正确的字符集
- 监控网站的中文显示情况