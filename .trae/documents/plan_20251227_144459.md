# 数据库连接问题修复方案

## 问题分析
1. MySQL服务正在运行，数据库和表结构正常
2. root用户对shoppingdb数据库有完全权限
3. 数据库配置文件db.properties配置看起来正确
4. 可能的问题：
   - 驱动版本兼容性问题
   - db.properties文件路径问题
   - 数据库URL参数配置问题
   - WAR包部署问题
   - 缺少必要的日志分析

## 修复步骤

### 1. 检查db.properties文件加载路径
- 将db.properties文件移动到src目录根下，确保能被正确加载
- 修改DBUtil.java中的加载路径

### 2. 优化数据库URL配置
- 修改数据库URL，添加autoReconnect=true等参数
- 调整时区设置

### 3. 验证驱动版本兼容性
- 确保MySQL驱动版本与MySQL服务器版本兼容
- 检查驱动JAR包是否正确打包到WAR文件中

### 4. 修复DBUtil.java代码
- 确保配置文件能被正确加载
- 添加日志记录，便于调试

### 5. 重新编译和部署
- 重新编译Java文件
- 重新打包WAR文件
- 清理Tomcat缓存
- 重新部署WAR文件

## 具体修改

### 1. 移动db.properties文件
- 将`src/com/shopping/util/db.properties`移动到`src/db.properties`

### 2. 修改DBUtil.java
```java
// 将配置文件加载路径改为
InputStream is = DBUtil.class.getClassLoader().getResourceAsStream("db.properties");
```

### 3. 优化db.properties配置
```properties
db.url=jdbc:mysql://localhost:3306/shoppingdb?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8&autoReconnect=true&failOverReadOnly=false&maxReconnects=10
db.username=root
db.password=qxy2041406827
db.driver=com.mysql.cj.jdbc.Driver
```

### 4. 重新编译和打包
```bash
# 重新编译Java文件
javac -d build -cp "WebContent/WEB-INF/lib/*" src/com/shopping/**/*.java

# 复制编译结果到WEB-INF/classes
xcopy /e /i /y build\* WebContent\WEB-INF\classes

# 复制db.properties到WEB-INF/classes
copy src\db.properties WebContent\WEB-INF\classes

# 重新打包WAR文件
jar -cvf shopping.war -C WebContent .
```

### 5. 清理Tomcat缓存并部署
- 删除Tomcat webapps目录下的shopping目录
- 删除Tomcat work目录下的所有文件
- 复制新的shopping.war到Tomcat webapps目录
- 重启Tomcat服务器

### 6. 查看Tomcat日志
- 查看Tomcat logs目录下的catalina.out或localhost.log文件，了解具体错误信息

## 预期效果
- 数据库连接正常
- 网站能够正常进行增删查改操作
- 登录、注册功能正常
- 产品列表能够正确显示

## 测试方法
1. 部署后访问`http://localhost:8080/shopping`
2. 尝试登录（管理员：admin/admin123，普通用户：user1/user123）
3. 查看产品列表
4. 尝试添加商品到购物车
5. 检查数据库中是否有对应记录